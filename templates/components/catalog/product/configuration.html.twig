<div {{ attributes }}>
    {% if this.addToCartResponse is not empty %}
        <div class="product__details-configuration_messages">
            {% if this.addToCartResponse['user_errors'] is empty %}
                <input aria-label="add to cart popup" type="checkbox" id="addToCartModal" class="modal-toggle" checked/>
                <div class="modal modal-bottom sm:modal-middle md:px-60">
                    <div class="modal-box">
                        <h3 class="font-bold text-lg text-center">{{ 'Succesfully added to cart'|trans }}</h3>
                        <div class="py-4">
                            <div class="flex gap-5">
                                <div class="grid auto-rows-min">
                                    {% if device.isSmartphone %}
                                        <img height="75" width="75" src="{{ product['small_image']['url']|cdn('auto', 'square', 75) }}" alt="">
                                    {% else %}
                                        <img height="120" width="120" src="{{ product['small_image']['url']|cdn('auto', 'square', 120) }}" alt="">
                                    {% endif %}
                                </div>
                                <div class="details grid gap-0 auto-rows-min grow">
                                    <strong>{{ product['name'] }}</strong>
                                    <span><strong>{{ 'Sku: '|trans }}</strong> {{ product['sku'] }}</span>
                                    <span><strong>{{ 'Quantity: '|trans }}</strong> {{ selectedQty }}</span>
                                    <span><strong>{{ 'Price: '|trans }}</strong> {{ (this.getProductFinalPrice * selectedQty)|format_currency('EUR', [], 'nl_NL') }}</span>
                                </div>
                            </div>
                            {% if device.isSmartphone != true and product['related_products']|length > 0 %}
                                <div class="divider lg:divider-vertical" style="margin-top: 4rem">
                                    <h3 class="text-3xl font-bold">{{ 'Related products'|trans }}</h3>
                                </div>
                                <div class="container mx-auto">
                                    <div class="product_row grid grid-cols-2 gap-4 mt-10 col-span-6">
                                        {% include 'catalog/_partials/product_list.html.twig' with {'limit': 2, 'items': product['related_products']} %}
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        <div class="modal-action justify-between">
                            <a href="{{ path('app_checkout_cart') }}" class="btn btn-outline btn-accent btn-sm">{{ 'Go to cart'|trans }}</a>
                            <label for="addToCartModal" class="btn btn-outline btn-sm">{{ 'Continue shopping'|trans }}</label>
                        </div>
                    </div>
                </div>
            {% else %}
                {% for error in this.addToCartResponse['user_errors'] %}
                    <div class="toast z-50 toast-top">
                        <div class="alert alert-error">
                            <div>
                                <span>{{ error['message']|trans }}</span>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    {% endif %}
    <div class="flex gap-3">
        <div class="grid">
            {% if false %}
                <div class="product__details-review mt-1">
                    <div class="rating rating-sm block mx-1 float-left">
                        {% for index in 0..4 %}
                            <input aria-label="rating-{{ index+1 }}" disabled type="radio" name="rating-{{ index }}" class="mt-1 mask mask-star-2 bg-accent" {% if index == 3 %} checked {% endif %} />
                        {% endfor %}
                    </div>
                    <a class="text-sm block mt-1 float-left ml-2" href="#reviews">120 reviews</a>
                </div>
            {% endif %}
            <div class="product__details-delivery block mt-4 md:mt-3">
                {{ 'Shipped in 5 - 10 working days' }}
            </div>
        </div>
        <div class="mt-2 text-right grid mr-1 grow">
            {% if this.getDiscountAmount > 0 %}
                <small class="grow product_row__from_price line-through text-sm">
                    {{ this.getProductRegularPrice|format_currency('EUR', [], 'nl_NL') }}
                </small>
            {% endif %}
            <strong class="grow product_row__final_price text-2xl md:text-5xl">
                {{ this.getProductFinalPrice|format_currency('EUR', [], 'nl_NL') }}
            </strong>
        </div>
    </div>
    {% if product['short_description']['html']|length > 0 %}
        <div class="product__details-short-description mt-3 sm:hidden lg:block">
            {{ product['short_description']['html']|raw }}
            <a class="mt-3 text-accent" href="#product-description">{{ 'Read more'|trans }}</a>
        </div>
    {% endif %}
    <div class="product__details-configuration mt-5 hidden md:block" id="productConfiguration">
        <div class="grid gap-4">
            {% if product['type_id'] == 'configurable' %}
                {% for attribute in product['configurable_options'] %}
                    <strong class="block">{{ 'Select a ' }}{{ attribute['label']|lower }}:</strong>
                    <div class="product__details-configuration-items grid grid-cols-5 auto-cols-max gap-2">
                        {% for value in attribute['values'] %}
                            <label
                                    for="{{ value['uid'] }}"
                                    class="px-4 cursor-pointer product__details-configuration-item {% if selectedSize ==  value['uid'] or attribute['values']|length == 1 %} __active  {% endif %}"
                            >
                                <input
                                        class="hidden"
                                        type="radio"
                                        id="{{ value['uid'] }}"
                                        name="{{ attribute['attribute_uid'] }}"
                                        value="{{ value['uid'] }}"
                                        data-model="selectedSize"
                                        data-action="click->live#action"
                                        data-action-name="updateProduct"
                                >
                                <span class="block py-2 text-center">
                                {{ value['store_label'] }}
                            </span>
                            </label>
                        {% endfor %}
                    </div>
                {% endfor %}
            {% endif %}
        </div>
        <div class="grid grid-cols-4 xl:grid-cols-5 gap-4 mt-4">
            <div>
                <select aria-label="select qty" required name="qty" id="qty" class="select select-accent w-full" data-model="selectedQty">
                    {% for index in 1..qtySelectorLimit %}
                        <option value="{{ index }}" {% if index == selectedQty %}selected {% endif %}>{{ index }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-span-3 md:col-span-4 grid gap-3">
                <button
                        class="btn btn-outline btn-accent flex"
                        data-action="click->live#action"
                        data-action-name="addProductToCart"
                >
                    <span class="grow">{{ 'Add to cart'|trans }}</span>
                    <i class="la la-cart-plus la-2x" style="margin-right: 5px"></i>
                </button>
            </div>
            <div class="grid col-span-4 md:col-span-5 grid-cols-2 gap-3">
                <button class="btn btn-sm btn-outline btn-error">
                    <span class="grow">{{ 'Add to wishlist'|trans }}</span>
                </button>
                <button class="btn btn-sm btn-outline btn-info">
                    <span class="grow">{{ 'Share'|trans }}</span>
                    <i class="la la-share" style="margin-right: 5px"></i>
                </button>
            </div>
        </div>
    </div>
    <div class="fixed bottom-0 left-0 right-0 bg-base-300 z-40" id="stickyAddToCart">
        <div class="container mx-auto px-5 xl:px-0 py-3 grid grid-cols-1 md:grid-cols-2 gap-5 items-center">
            <div class="grid grid-cols-4">
                <h4 class="col-span-3 text-lg font-bold">{{ product['name']|replace({'(': "<br />", ')': ''})|raw }}</h4>
                <div class="text-center grid">
                    {% if this.getDiscountAmount > 0 %}
                        <small class="grow product_row__from_price line-through text-sm">
                            {{ this.getProductRegularPrice|format_currency('EUR', [], 'nl_NL') }}
                        </small>
                    {% endif %}
                    <strong class="grow product_row__final_price text-lg">
                        {{ this.getProductFinalPrice|format_currency('EUR', [], 'nl_NL') }}
                    </strong>
                </div>
            </div>
            <div class="flex gap-2">
                <div>
                    {% if product['type_id'] == 'configurable' %}
                        {% for attribute in product['configurable_options'] %}
                            <select
                                    class="select select-accent w-full"
                                    data-model="selectedSize"
                                    data-action="change->live#action"
                                    data-action-name="updateProduct"
                                    aria-label="Select product option" name="{{ attribute['attribute_uid'] }}">
                                <option selected>{{ 'Select a ' }}{{ attribute['label']|lower }}</option>
                                {% for value in attribute['values'] %}
                                    <option value="{{ value['uid'] }}">{{ value['store_label'] }}</option>
                                {% endfor %}
                            </select>
                        {% endfor %}
                    {% endif %}
                </div>
                <div>
                    <select aria-label="select qty" required name="qty" id="qty" class="select select-accent w-full" data-model="selectedQty">
                        {% for index in 1..qtySelectorLimit %}
                            <option value="{{ index }}" {% if index == selectedQty %}selected {% endif %}>{{ index }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="grow">
                    <button
                            class="btn btn-outline btn-accent"
                            data-action="click->live#action"
                            data-action-name="addProductToCart"
                    >
                        <span class="hidden md:block">{{ 'Add to cart'|trans }}</span>
                        <span class="md:hidden">{{ 'Add.'|trans }}</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% if device.isSmartphone != true %}
        <script>
            function isElementInViewport(el) {
                const rect = el.getBoundingClientRect();

                return (
                    rect.top >= 0 &&
                    rect.left >= 0 &&
                    rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && /* or $(window).height() */
                    rect.right <= (window.innerWidth || document.documentElement.clientWidth) /* or $(window).width() */
                );
            }

            const el = document.getElementById('productConfiguration');
            const stickyAddToCart = document.getElementById('stickyAddToCart');
            if (isElementInViewport(el)) {
                stickyAddToCart.style.height = '0';
            } else {
                stickyAddToCart.style.height = '72px';
            }

            window.onscroll = function () {
                const el = document.getElementById('productConfiguration');
                const stickyAddToCart = document.getElementById('stickyAddToCart');
                if (this.isElementInViewport(el)) {
                    stickyAddToCart.style.height = '0';
                } else {
                    stickyAddToCart.style.height = '72px';
                }
            }
        </script>
    {% endif %}
</div>
